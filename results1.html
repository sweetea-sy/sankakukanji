<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hasil Latihan - Tipe 1</title>

<style>
  :root{
    --shadow: 0 18px 55px rgba(0,0,0,.18);
    --stroke:#111;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    height:100vh;
    display:grid;
    place-items:center;
    background:#f2f4f7;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    overflow:hidden;
    padding:18px 16px;
  }

  .phone{
    width:min(420px,92vw);
    height:calc(100vh - 36px);
    max-height:920px;
    border-radius:34px;
    overflow:hidden;
    box-shadow:var(--shadow);
    background:#fff;
    position:relative;
  }

  .bg{
    position:absolute; inset:0;
    background:url("sankaku.png") center/cover no-repeat;
  }

  .layer{
    position:absolute; inset:0;
    display:flex;
    flex-direction:column;
  }

  .top-gap{ height: 18px; flex:0 0 auto; }

  .panel{
    background: rgba(255,255,255,.96);
    flex: 1 1 auto;
    min-height:0;
    display:flex;
    flex-direction:column;
    padding: 14px 16px 10px;
  }

  .title{
    font-weight: 1000;
    font-size: 22px;
    margin: 6px 0 6px;
    text-align:center;
  }

  .meta{
    text-align:center;
    font-weight:900;
    margin-bottom: 12px;
  }

  /* ====== CARD LIST (style seperti gambar 2) ====== */
  .card{
    border: 2px solid rgba(0,0,0,.15);
    border-radius: 14px;
    overflow:hidden;
    background: rgba(255,255,255,.45);
  }
  .card-head{
    padding: 10px 12px;
    font-weight: 1000;
    background: rgba(0,0,0,.06);
    border-bottom: 1px solid rgba(0,0,0,.10);
  }

  .list{
    max-height: 44vh;
    overflow:auto;
    -webkit-overflow-scrolling: touch;
  }

  .row{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding: 10px 12px;
    border-top: 1px solid rgba(0,0,0,.10);
    gap: 10px;
    background: rgba(255,255,255,.35);
  }
  .row:first-child{ border-top:0; }

  .row-left{
    font-weight: 1000;
    width: 28px;
  }

  .row-right{
    display:flex;
    align-items:center;
    gap: 10px;
    font-weight: 900;
    margin-left:auto;
  }

  .pill{
    padding: 6px 10px;
    border-radius: 999px;
    border: 2px solid rgba(0,0,0,.18);
    font-size: 12px;
    white-space:nowrap;
    background: rgba(255,255,255,.6);
  }

  .badge{
    width: 34px;
    height: 34px;
    border-radius: 999px;
    display:grid;
    place-items:center;
    font-weight: 1000;
    border: 2px solid rgba(0,0,0,.2);
    background:#fff;
  }
  .badge.ok{ background: rgba(34,197,94,.15); }
  .badge.no{ background: rgba(239,68,68,.15); }
  .badge.na{ background: rgba(0,0,0,.05); }

  .footer{
    padding: 10px 0 0;
    flex: 0 0 auto;
  }

  .divider{
    height:1px;
    background: rgba(0,0,0,.25);
    width:70%;
    margin: 8px auto 8px;
  }
  .footer-text{
    text-align:center;
    font-weight:900;
    font-size:14px;
    margin: 0 0 4px;
  }

  .actions{
    display:flex;
    gap:10px;
    margin-top: 12px;
  }
  .btn{
    flex:1;
    padding: 12px 12px;
    border-radius: 10px;
    border: 2px solid #111;
    background:#fff;
    font-weight: 1000;
    cursor:pointer;
    box-shadow: 0 8px 0 rgba(0,0,0,.55);
  }
  .btn:active{
    transform: translateY(3px);
    box-shadow: 0 5px 0 rgba(0,0,0,.55);
  }

  @media (max-width: 768px) {
    body{ padding: 0; background: #000; }
    .phone{
      width: 100vw;
      height: 100vh;
      max-height: none;
      border-radius: 0;
      box-shadow: none;
    }
  }
</style>
</head>

<body>
<div class="phone">
  <div class="bg" aria-hidden="true"></div>

  <div class="layer">
    <div class="top-gap"></div>

    <div class="panel">
      <div class="title">HASIL LATIHAN "一" </div>
      <div class="meta" id="meta">...</div>

      <div class="card">
        <div class="card-head" id="rangeTitle">Soal 1 – 0</div>
        <div class="list" id="list"></div>
      </div>

      <div class="actions">
        <button class="btn" id="btnRetry">Ulangi</button>
        <button class="btn" id="btnHome">Home</button>
      </div>

      <div class="footer">
        <div class="divider"></div>
        <div class="footer-text">N3 Nihongo Sou Matome</div>
      </div>
    </div>
  </div>
</div>

<script>
  // =========================
  // HARUS SAMA dengan quiz-type-1.html
  // =========================
  const QUESTIONS = [
    {
      text: '(「飛び出し注意」)と書いてあります。',
      options: ['とびだしじゅうい','とびだしちゅうい','とびだししゅうい','とびだしじょうい'],
      correctIndex: 1
    },
    {
      text: 'この時計は(正確)です。',
      options: ['せいかく','せっかく','しょうかく','しようかく'],
      correctIndex: 0
    },
    {
      text: '(横断)歩道をわたりましょう。',
      options: ['こうだん','おうだん','かいへん','そうだん'],
      correctIndex: 1
    },
    {
      text: 'このなべは(鉄)で作られています。',
      options: ['しつ','ねつ','れつ','てつ'],
      correctIndex: 3
    },
    {
      text: '(優先)席ではけいたい電話を使わないでください。',
      options: ['うせん','にゅうせん','ゆうせん','ようせん'],
      correctIndex: 2
    },
    {
      text: '料金は(降りる)ときにはらってください。',
      options: ['のりる','ふりる','こりる','おりる'],
      correctIndex: 3
    },
    {
      text: '(関係者)以外入らないでください。',
      options: ['かんけいしゃ','かんれんしゃ','けいけんしゃ','かんきょうしゃ'],
      correctIndex: 0
    },
    {
      text: '(確認)ボタンを押します。',
      options: ['きにん','かくにん','しょうにん','こうにん'],
      correctIndex: 1
    },
    {
      text: 'ドアの(横)にスイッチがあります。',
      options: ['まえ','よこ','たて','となり'],
      correctIndex: 1
    },
    {
      text: '高速道路から(飛行場)が見えます。',
      options: ['こうそくろ','ひこうば','くうこう','ひこうじょう'],
      correctIndex: 3
    },
    {
      text: '駅は(なんばん)ですか。',
      options: ['何号','向番','何番','向号'],
      correctIndex: 2
    },
    {
      text: '黄色い(せん)を下がってお待ちください。',
      options: ['線','信','段','側'],
      correctIndex: 0
    },
    {
      text: 'あの女優は(ひょうげん)力がある。',
      options: ['表信','表現','表見','表現'],
      correctIndex: 3
    },
    {
      text: '社長はそれを(みとめた)。',
      options: ['定めた','認めた','愛めた','面めた'],
      correctIndex: 1
    },
    {
      text: 'この電車は（　）駅に止まります。',
      options: ['毎','次','各','両'],
      correctIndex: 2
    },
    {
      text: 'あの信号は押しボタン（　）です。',
      options: ['箱','席','向','式'],
      correctIndex: 3
    },
    {
      text: '駐車場はただいま（　）車です。',
      options: ['両','満','禁','非'],
      correctIndex: 1
    },
    {
      text: '1万円以上は、送料（　）料です。',
      options: ['非','不','無','禁'],
      correctIndex: 2
    },
    {
      text: '整理（　）を取ってお待ちください。',
      options: ['係','箱','路','券'],
      correctIndex: 3
    },
    {
      text: 'お会計は料金（　）に入れてください。',
      options: ['箱','式','鞄','袋'],
      correctIndex: 0
    }
  ];

  const LS_KEY_ANS = 'sankaku_quiz_type1_answers';
  const LS_KEY_IDX = 'sankaku_quiz_type1_index';

  function loadAnswers(){
    try {
      return JSON.parse(localStorage.getItem(LS_KEY_ANS) || '{}');
    } catch {
      return {};
    }
  }

  const answers = loadAnswers();
  const listEl = document.getElementById('list');

  // =========================
  // TOTAL SCORE
  // =========================
  let totalScore = 0;
  QUESTIONS.forEach((_, i) => {
    if (answers[i]?.correct) totalScore += 5;
  });

  document.getElementById('meta').textContent =
    `Jumlah Soal: ${QUESTIONS.length} | Total Nilai: ${totalScore}`;

  document.getElementById('rangeTitle').textContent = `Soal 1 – ${QUESTIONS.length}`;

  // ambil percobaan keberapa baru benar/menang (fleksibel field)
  function getAttemptWin(data){
    const v =
      data?.attemptWin ??
      data?.attempt ??
      data?.tries ??
      data?.attemptCount ??
      data?.tryCount ??
      null;

    if (typeof v === 'number' && isFinite(v) && v > 0) return v;
    if (typeof v === 'string' && v.trim() && !isNaN(Number(v))) return Number(v);
    return null;
  }

  // =========================
  // RENDER LIST
  // =========================
  QUESTIONS.forEach((_, i) => {
    const data = answers[i];
    const score = data?.correct ? 5 : 0;

    let status = 'na';
    if (data?.correct) status = 'ok';
    else if (data) status = 'no';

    const attemptWin = getAttemptWin(data);

    const row = document.createElement('div');
    row.className = 'row';

    const left = document.createElement('div');
    left.className = 'row-left';
    left.textContent = `${i + 1}.`;

    const right = document.createElement('div');
    right.className = 'row-right';

    const pillTry = document.createElement('div');
    pillTry.className = 'pill';
    pillTry.textContent = `Percobaan: ${attemptWin ?? '–'}`;

    const pillScore = document.createElement('div');
    pillScore.className = 'pill';
    pillScore.textContent = `Nilai: ${score}`;

    const badge = document.createElement('div');
    badge.className = `badge ${status}`;
    badge.textContent = data?.correct ? '✓' : data ? '✕' : '–';

    right.appendChild(pillTry);
    right.appendChild(pillScore);
    right.appendChild(badge);

    row.appendChild(left);
    row.appendChild(right);
    listEl.appendChild(row);
  });

  document.getElementById('btnRetry').addEventListener('click', () => {
    localStorage.removeItem(LS_KEY_ANS);
    localStorage.removeItem(LS_KEY_IDX);
    window.location.href = 'quiz-type-1.html';
  });

  document.getElementById('btnHome').addEventListener('click', () => {
    window.location.href = 'menu.html';
  });
</script>

</body>
</html>
